# Redis

## 1. 什么是nosql

全称not only sql和传统的关系系数据库(mysql、oracle)相比，它不需要创建关系模型表(二维表) 数据和数据之间 也可以没有必然的联系 底层是基于key-value存储的 而且是在内存中进行存储 读写速度远远高于 传统的关系型数据库

## 2. 什么是Redis

redis是一个开源的，使用C语言编写 支持网络交互，可以基于内存存储，也可以支持持久化存储 读写速度非常快 支持事务(没有回滚)，还可以设置过期时间 非常适合做缓存操作 

#### 2.1 redis应用场景

- 缓存：第一次查询mysql，并且存储在redis中，再次查询相同的数据时走redis不走mysql，数据如果修改了 清空redis缓存
- 计数：点赞量 下载量 粉丝量 ... redis有一个实现自增 自减的命令 专门用来计数，而且不会出现并发问题 因为他们的自增自减具有原子性
- 排行榜：(推荐帖子 推荐消息 推荐积分 推荐商家...) redis有一个专门的数据类型 可以进行排序 可以把存储的数据绑定一个分数 可以根据分数排序 ...
- 好友关系：(共同爱好 共同好友 共同粉丝 ...) redis有一个类型专门实现并集 差集 很容易实现 数据之间的关系
- session共享：以后做了集群模式，每个服务器都会有一个session
- 简单的队列：只能完成简单的队列 复杂的队列可以交给RabbitMQ来实现

#### 2.2 Redis环境搭建

- 安装redis：不用安装 解压即可使用 ---不重要
- 找到redis配置文件 在根目录下创建`/config/redis.conf`
- 配置redis配置文件

```sql
# 设置绑定的ip地址，客户端是通过这个ip地址去连接服务器
bind 192.168.11.27
# 指定是否开启保护模式，如果开启了 需要访问密码
protected-mode no
# 端口号 可以任意写 只要保证端口不冲突即可
port 6379
# 设置是否为守护进程，如果开启 redis可以后台运行
daemonize yes
# 保存进程id的目录
pidfile /var/run/redis_6379.pid
# 保存日志的目录
logfile /usr/local/sc240601/redis-5.0.3/log/redis_6379.log
# 持久化文件名
dbfilename redis_6379.rdb
# 持久化路径
dir /usr/local/sc240601/redis-5.0.3/data/
```

- redis是基于C/S架构的 通过redis服务端命令启动redis

  ```
  redis-server 指定的包的配置文件(注意选自己配置的包/config/redis.conf)
  ```

  - ps -ef | grep redis 查看是否启动成功了 如果启动失败了 查看日志

- 通过redis客户端连接redis服务端

  ```sql
  redis-cli -h 服务端ip地址 -p 服务端端口号
  
  -- 测试结果
  ip地址:端口号>
  ```

  - 写redis代码

## 3. Redis基本命令 ---重要

#### 3.1 通用命令

无论什么类型都可以使用的命令

```sql
keys 正则		：查看符合条件的key
select 数字	：切换数据库	Redis默认创建16个数据库(通过0~15进行切换)
type key	  ：查看key的类型
dbsize		  ：查看数据库中key的数量
exists key	  ：查看key是否存在 返回1/0
del key		  ：根据key来删除

rename oldkey newkey 	：给key重命名 如果newkey已经存在 会替换 可能会出现数据丢失
renamenx oldkey newkey	：给key重命名 如果newkey不存在 才可以重命名
expire key 秒		    ：设置key多少秒失效
pexpire key 毫秒		   ：设置key多少毫秒失效
ttl key					：查看key剩余时间 -1永久存在 -2不存在
persist key				：取消过期时间
flushdb					：清空redis 慎用
```

#### 3.2 Redis基本数据类型 --- 面试题

- String：是一个二进制类型 可以存储字符串 图片 视频 音频 也可以存储一些静态资源文件(js css) String类型每个value最大值512M
  - 缓存
  - 计数：有自增自减原子性的操作
- list：是一个列表类型 底层是双向链表结构 类似于java中的LinkedList 是一个有序的 可以重复的集合
  - 简单的队列

- set：是无序集合类型 底层是通过hashtable实现的 查找元素和删除元素都特别快 可以通过它记录一些不重复的数据
  - 共同爱好 共同好友 粉丝：有一个实现交集并集差集
  - 抽奖功能 点名：有一个命令随机获取集合中的元素
- Sortek Set：简称ZSet 叫有序集合 类似于set 元素是唯一的 只不过底层是通过每个元素会绑定一个double类型分数(积分数 礼物数 点赞数) redis通过分数 对集合的元素进行 升序降序排序 集合元素是唯一的 但是分数是可以重复的
  - 排行榜相关应用：这个类型会自动根据分数排序，把集合的元素存储用户信息 分数表示礼物数量
- Hash：类似于一个Map集合又存储了一个Map集合 每个key都会对应一个hashtabe 适合存储对象数据 比如：key 对应用户id value(key:对象的属性名 value:对象的属性值)
  - 适合存储对象类型

#### 3.3 String类型命令



#### 3.4 List类型命令